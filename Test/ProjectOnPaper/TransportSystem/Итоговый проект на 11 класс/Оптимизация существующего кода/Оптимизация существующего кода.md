# Наследие
Предыдущие разработчики (то есть мы 3-5 месяцев назад) оставили код с отрисовкой множества плиток в изометрическом виде. На каждую плитку отводилось 4 вершины, изменённых при помощи матрицы поворота на 45 градусов. 

Все вершины одного чанка хранились в sf::vertex_buffer - по сути, аналог вектора вершин, но более приспособленный для SFML, т.к. написан этими же разработчиками. Рассмотрим алгоритм загрузки нужных плиток из чанка:
```cpp
std::vector<sf::Vertex> vertecies;
sf::Vector2f chunkPos = sf::Vector2f{ chunk->first.v };
chunkPos.x *= SIZE_CHUNK;
chunkPos.x -= RADIUS_RENDER;
chunkPos.y *= SIZE_CHUNK;
chunkPos.y -= RADIUS_RENDER;
uint32_t i = 0;
for (auto tile : chunk->second)
{
	sf::Vector2f pos = { float(i % SIZE_CHUNK), float(i / SIZE_CHUNK) };
	sf::Vertex v[4] = {
		{ CartesianToIsometric(sf::Vector2f{ 0.0f, 0.0f } + chunkPos + pos, SIZE_TILE_IN_PIXEL)},
		{ CartesianToIsometric(sf::Vector2f{ 1.0f, 0.0f } + chunkPos + pos, SIZE_TILE_IN_PIXEL)},
		{ CartesianToIsometric(sf::Vector2f{ 1.0f, 1.0f } + chunkPos + pos, SIZE_TILE_IN_PIXEL)},
		{ CartesianToIsometric(sf::Vector2f{ 0.0f, 1.0f } + chunkPos + pos, SIZE_TILE_IN_PIXEL)},
	};
	float r = 0.0;

	if (tile == char(TileAssociation::Grass))
	{
		r = 1;
	}
	else
	{
		r = 2;
	}

	v[0].texCoords = sf::Vector2f{ SIZE_TILE_IN_PIXEL * (r - 1), 0.0f };
	v[1].texCoords = sf::Vector2f{ SIZE_TILE_IN_PIXEL * r, 0.0f };
	v[2].texCoords = sf::Vector2f{ SIZE_TILE_IN_PIXEL * r, SIZE_TILE_IN_PIXEL };
	v[3].texCoords = sf::Vector2f{ SIZE_TILE_IN_PIXEL * (r - 1), SIZE_TILE_IN_PIXEL };
	i++;

	for (size_t i = 0; i < 4; i++)
	{
		vertecies.push_back(v[i]);
	}
}
visibleChunks[indexOfBuffer].update(vertecies.data());
```
Как видно из кода выше, изначально создается массив вершин, которые преобразуются из декартовых координат в изометрические, далее идет сравнение полученной из файла буквы с заготовленной таблицей ассоциаций букв с видом плитки. Далее идет загрузка нужных координат из файла с текстурами и привязка их к соответствующим вершинам.
![[Chunk.png]]
Как видно из скрина выше, производительность оставляет желать лучшего, всего 280 fps в максимуме с просадками до 80, при чем сама картинка статична и ничего не происходит. Для дальнейшей комфортной разработки проекта необходимо оптимизировать отрисовку плиток по крайней мере до 3-4 тысяч fps. 

Как это можно сделать? Ответ простой - [[Шейдеры]].



